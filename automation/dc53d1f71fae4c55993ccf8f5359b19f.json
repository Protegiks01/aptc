[
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [TCP buffer configs] [Buffer size attack] Can TCPBufferCfg::new_configs() with extreme values (0 or usize::MAX) cause TCP socket configuration failures, connection drops, or kernel resource exhaustion? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_52ab8054-a9fd-41e7-a05d-edbb8052034d?mode=deep",
    "timestamp": "2026-01-26 05:00:32.992389",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: new_for_test()] [Default TCP buffer vulnerability] Using TCPBufferCfg::default() in test mode - can default buffer sizes be inappropriate for production workloads, causing connection instability or performance degradation if test mode leaks to production? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_a3498261-8fee-4081-a87c-0333d60697bd?mode=deep",
    "timestamp": "2026-01-26 05:00:45.323709",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: add_connectivity_manager()] [Connectivity check interval zero] Can connectivity_check_interval_ms = 0 cause infinite loop in connectivity checker, consuming 100% CPU and preventing consensus participation? (High)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_66b73df7-704b-47ba-bae5-39f7d5e9f3a8?mode=deep",
    "timestamp": "2026-01-26 05:00:58.095733",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: create()] [Identity key vs peer ID mismatch] Is the identity_key cryptographically bound to peer_id, or can an attacker use a valid identity key with a different peer ID to impersonate another validator? (Critical)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_12eec7a1-eb53-4443-9e3f-1f37508d3c7f?mode=deep",
    "timestamp": "2026-01-26 05:01:12.554901",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: merge_seeds()] [Keys insertion race] When keys.insert(pubkey) is called in the iterator, can concurrent modifications to keys HashSet cause race conditions or lost insertions? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_e6cbea6a-1e20-4cb1-8982-bc8b24d21d73?mode=deep",
    "timestamp": "2026-01-26 05:01:26.907583",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: setup_discovery()] [Discovery method None with empty seeds] If DiscoveryMethod::None is used with empty seed set, can validators become completely isolated with no peers, causing total loss of liveness? (High)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_51723fa5-9475-4cf3-8ec1-9738968f6367?mode=deep",
    "timestamp": "2026-01-26 05:01:41.274219",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: create()] [Event subscription leak] If reconfig_subscription_service.subscribe_to_reconfigurations() is called but the NetworkBuilder is never started, does the subscription leak resources or prevent proper cleanup? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_39fb07ef-e2f3-41a3-8774-d83a8ec0aac1?mode=deep",
    "timestamp": "2026-01-26 05:01:57.386355",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: merge_seeds()] [Address filtering bypass] When filtering addresses with filter_map(NetworkAddress::find_noise_proto), can an attacker provide addresses that bypass filtering through crafted encoding but are processed later? (High)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_eb5b8ab0-4259-4296-9855-afcade437bda?mode=deep",
    "timestamp": "2026-01-26 05:02:14.047018",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: new()] [Chain ID confusion] Can validators on different chains (same codebase, different ChainId) accidentally peer with each other, causing cross-chain state confusion or consensus failures? (Critical)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_76d47a5d-036d-48a7-a5ba-e5c18bd52873?mode=deep",
    "timestamp": "2026-01-26 05:02:32.262314",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: add_connectivity_manager()] [Connection request sender cloning] ConnectionRequestSender wraps connection_reqs_tx - can unauthorized cloning of this sender bypass connectivity manager controls, allowing direct peer connection manipulation? (High)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_54c3b23a-77d4-4b5c-9d7b-69f3f532c99e?mode=deep",
    "timestamp": "2026-01-26 05:02:51.037944",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: start()] [Discovery listener error handling] When listener.start(executor) is called for each discovery listener, are start failures properly handled, or can a failing listener block subsequent listeners from starting? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_dd8c4cc3-6b79-4c9b-b4a4-309ab58c7d00?mode=deep",
    "timestamp": "2026-01-26 05:03:10.403811",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: create()] [Connection backoff underflow] If connection_backoff_base is very small and max_connection_delay_ms is large, can the backoff calculation underflow or produce negative delays, causing immediate reconnection attempts? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_7c21acea-0bed-4b2c-baee-3b68e7f62bdd?mode=deep",
    "timestamp": "2026-01-26 05:03:31.027717",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: add_connectivity_manager()] [PM connection event race] The pm_conn_mgr_notifs_rx channel receives connection events - can high-frequency connect/disconnect events overflow this channel, causing event loss and stale connection state? (High)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_5f686015-44d9-416e-8612-d5a5436edbd5?mode=deep",
    "timestamp": "2026-01-26 05:03:51.889805",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: new()] [Listen address IPv4/IPv6 confusion] Can listen_address contain both IPv4 and IPv6 addresses or transitions between them, causing binding failures or connection routing errors? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_31eac811-b54a-4bbe-aec6-5d148d1b6cbe?mode=deep",
    "timestamp": "2026-01-26 05:04:13.375705",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: create()] [Max outbound connections zero] Can config.max_outbound_connections = 0 cause validators to never establish outbound connections, relying only on inbound connections and creating asymmetric connectivity vulnerable to eclipse attacks? (High)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_c4a3d53c-b4db-40bf-8b54-2545dde19005?mode=deep",
    "timestamp": "2026-01-26 05:04:35.291699",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: add_connectivity_manager()] [Enable latency dialing time] When enable_latency_aware_dialing is enabled, are latency measurements secure against manipulation, or can an attacker influence which peers are prioritized through crafted latency responses? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_90069514-c86c-4bf5-b022-c5e27de6d346?mode=deep",
    "timestamp": "2026-01-26 05:04:58.714693",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: merge_seeds()] [Seed_addrs deprecation risk] The comment mentions seed_addrs will be removed - can migration bugs between old seed_addrs and new seeds format cause validators to lose peer information during upgrades? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_5d156cde-3fb2-4df9-8fb1-f7cca946289b?mode=deep",
    "timestamp": "2026-01-26 05:05:21.573108",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: add_connection_monitoring()] [Max deserialization None] When max_parallel_deserialization_tasks is None (unbounded), can an attacker send specially crafted messages requiring expensive deserialization to spawn unlimited tasks and exhaust threads? (High)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_5e341ca4-e77f-403e-8c69-6ac27b36cad4?mode=deep",
    "timestamp": "2026-01-26 05:05:44.961418",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/network/builder/src/builder.rs] [Function: add_client_and_service()] [Allow out-of-order guarantee]\n\n### Citations\n\n**File:** network/builder/src/builder.rs (L1-511)\n```rust\n// Copyright © Aptos Foundation\n// Parts of the project are originally copyright © Meta Platforms, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\n//! Remotely authenticated vs. unauthenticated network end-points:\n//! ---------------------------------------------------\n//! A network end-point operates with remote authentication if it only accepts connections\n//! from a known set of peers (`trusted_peers`) identified by their network identity keys.\n//! This does not mean that the other end-point of a connection also needs to operate with\n//! authentication -- a network end-point running with remote authentication enabled will\n//! connect to or accept connections from an end-point running in authenticated mode as\n//! long as the latter is in its trusted peers set.\nuse aptos_config::{\n    config::{\n        DiscoveryMethod, NetworkConfig, Peer, PeerRole, PeerSet, RoleType, CONNECTION_BACKOFF_BASE,\n        CONNECTIVITY_CHECK_INTERVAL_MS, MAX_CONNECTION_DELAY_MS, MAX_FRAME_SIZE,\n        MAX_FULLNODE_OUTBOUND_CONNECTIONS, MAX_INBOUND_CONNECTIONS, NETWORK_CHANNEL_SIZE,\n    },\n    network_id::NetworkContext,\n};\nuse aptos_event_notifications::{DbBackedOnChainConfig, EventSubscriptionService};\nuse aptos_logger::prelude::*;\nuse aptos_netcore::transport::tcp::TCPBufferCfg;\nuse aptos_network::{\n    application::storage::PeersAndMetadata,\n    connectivity_manager::{builder::ConnectivityManagerBuilder, ConnectivityRequest},\n    constants::MAX_MESSAGE_SIZE,\n    logging::NetworkSchema,\n    peer_manager::{\n        builder::{AuthenticationMode, PeerManagerBuilder},\n        ConnectionRequestSender,\n    },\n    protocols::{\n        health_checker::{self, builder::HealthCheckerBuilder},\n        network::{\n            NetworkApplicationConfig, NetworkClientConfig, NetworkServiceConfig, NewNetworkEvents,\n            NewNetworkSender,\n        },\n    },\n};\nuse aptos_network_discovery::DiscoveryChangeListener;\nuse aptos_time_service::TimeService;\nuse aptos_types::{chain_id::ChainId, network_address::NetworkAddress};\nuse std::{clone::Clone, collections::HashSet, sync::Arc, time::Duration};\nuse tokio::runtime::Handle;\n\n#[derive(Debug, PartialEq, PartialOrd)]\nenum State {\n    CREATED,\n    BUILT,\n    STARTED,\n}\n\n/// Build Network module with custom configuration values.\n/// Methods can be chained in order to set the configuration values.\n/// MempoolNetworkHandler and ConsensusNetworkHandler are constructed by calling\n/// [`NetworkBuilder::build`].  New instances of `NetworkBuilder` are obtained\n/// via [`NetworkBuilder::create`].\npub struct NetworkBuilder {\n    state: State,\n    executor: Option<Handle>,\n    time_service: TimeService,\n    network_context: NetworkContext,\n    discovery_listeners: Option<Vec<DiscoveryChangeListener<DbBackedOnChainConfig>>>,\n    connectivity_manager_builder: Option<ConnectivityManagerBuilder>,\n    health_checker_builder: Option<HealthCheckerBuilder>,\n    peer_manager_builder: PeerManagerBuilder,\n    peers_and_metadata: Arc<PeersAndMetadata>,\n}\n\nimpl NetworkBuilder {\n    /// Return a new NetworkBuilder initialized with default configuration values.\n    // TODO:  Remove `pub`.  NetworkBuilder should only be created through `::create()`\n    #[allow(clippy::too_many_arguments)]\n    pub fn new(\n        chain_id: ChainId,\n        peers_and_metadata: Arc<PeersAndMetadata>,\n        network_context: NetworkContext,\n        time_service: TimeService,\n        listen_address: NetworkAddress,\n        authentication_mode: AuthenticationMode,\n        max_frame_size: usize,\n        max_message_size: usize,\n        enable_proxy_protocol: bool,\n        network_channel_size: usize,\n        inbound_connection_limit: usize,\n        tcp_buffer_cfg: TCPBufferCfg,\n    ) -> Self {\n        // A network cannot exist without a PeerManager\n        // TODO:  construct this in create and pass it to new() as a parameter. The complication is manual construction of NetworkBuilder in various tests.\n        let peer_manager_builder = PeerManagerBuilder::create(\n            chain_id,\n            network_context,\n            time_service.clone(),\n            listen_address,\n            peers_and_metadata.clone(),\n            authentication_mode,\n            network_channel_size,\n            max_frame_size,\n            max_message_size,\n            enable_proxy_protocol,\n            inbound_connection_limit,\n            tcp_buffer_cfg,\n        );\n\n        NetworkBuilder {\n            state: State::CREATED,\n            executor: None,\n            time_service,\n            network_context,\n            discovery_listeners: None,\n            connectivity_manager_builder: None,\n            health_checker_builder: None,\n            peer_manager_builder,\n            peers_and_metadata,\n        }\n    }\n\n    pub fn new_for_test(\n        chain_id: ChainId,\n        seeds: PeerSet,\n        network_context: NetworkContext,\n        time_service: TimeService,\n        listen_address: NetworkAddress,\n        authentication_mode: AuthenticationMode,\n        peers_and_metadata: Arc<PeersAndMetadata>,\n    ) -> NetworkBuilder {\n        let mutual_authentication = matches!(authentication_mode, AuthenticationMode::Mutual(_));\n\n        let mut builder = NetworkBuilder::new(\n            chain_id,\n            peers_and_metadata.clone(),\n            network_context,\n            time_service,\n            listen_address,\n            authentication_mode,\n            MAX_FRAME_SIZE,\n            MAX_MESSAGE_SIZE,\n            false, /* Disable proxy protocol */\n            NETWORK_CHANNEL_SIZE,\n            MAX_INBOUND_CONNECTIONS,\n            TCPBufferCfg::default(),\n        );\n\n        builder.add_connectivity_manager(\n            seeds,\n            peers_and_metadata,\n            MAX_FULLNODE_OUTBOUND_CONNECTIONS,\n            CONNECTION_BACKOFF_BASE,\n            MAX_CONNECTION_DELAY_MS,\n            CONNECTIVITY_CHECK_INTERVAL_MS,\n            NETWORK_CHANNEL_SIZE,\n            mutual_authentication,\n            true, /* enable_latency_aware_dialing */\n        );\n\n        builder\n    }\n\n    /// Create a new NetworkBuilder based on the provided configuration.\n    pub fn create(\n        chain_id: ChainId,\n        role: RoleType,\n        config: &NetworkConfig,\n        time_service: TimeService,\n        reconfig_subscription_service: Option<&mut EventSubscriptionService>,\n        peers_and_metadata: Arc<PeersAndMetadata>,\n    ) -> NetworkBuilder {\n        let peer_id = config.peer_id();\n        let identity_key = config.identity_key();\n\n        let authentication_mode = if config.mutual_authentication {\n            AuthenticationMode::Mutual(identity_key)\n        } else {\n            AuthenticationMode::MaybeMutual(identity_key)\n        };\n\n        let network_context = NetworkContext::new(role, config.network_id, peer_id);\n\n        let mut network_builder = NetworkBuilder::new(\n            chain_id,\n            peers_and_metadata.clone(),\n            network_context,\n            time_service,\n            config.listen_address.clone(),\n            authentication_mode,\n            config.max_frame_size,\n            config.max_message_size,\n            config.enable_proxy_protocol,\n            config.network_channel_size,\n            config.max_inbound_connections,\n            TCPBufferCfg::new_configs(\n                config.inbound_rx_buffer_size_bytes,\n                config.inbound_tx_buffer_size_bytes,\n                config.outbound_rx_buffer_size_bytes,\n                config.outbound_tx_buffer_size_bytes,\n            ),\n        );\n\n        network_builder.add_connection_monitoring(\n            config.ping_interval_ms,\n            config.ping_timeout_ms,\n            config.ping_failures_tolerated,\n            config.max_parallel_deserialization_tasks,\n        );\n\n        // Always add a connectivity manager to keep track of known peers\n        let seeds = merge_seeds(config);\n\n        network_builder.add_connectivity_manager(\n            seeds,\n            peers_and_metadata,\n            config.max_outbound_connections,\n            config.connection_backoff_base,\n            config.max_connection_delay_ms,\n            config.connectivity_check_interval_ms,\n            config.network_channel_size,\n            config.mutual_authentication,\n            config.enable_latency_aware_dialing,\n        );\n\n        network_builder.discovery_listeners = Some(Vec::new());\n        network_builder.setup_discovery(config, reconfig_subscription_service);\n\n        // Ensure there are no duplicate source types\n        let set: HashSet<_> = network_builder\n            .discovery_listeners\n            .as_ref()\n            .unwrap()\n            .iter()\n            .map(|listener| listener.discovery_source())\n            .collect();\n        assert_eq!(\n            set.len(),\n            network_builder.discovery_listeners.as_ref().unwrap().len()\n        );\n\n        network_builder\n    }\n\n    /// Create the configured Networking components.\n    pub fn build(&mut self, executor: Handle) -> &mut Self {\n        assert_eq!(self.state, State::CREATED);\n        self.state = State::BUILT;\n        self.executor = Some(executor);\n        self.peer_manager_builder\n            .build(self.executor.as_mut().expect(",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_ee5103b8-89e4-45ae-8b3d-560e8e90c676?mode=deep",
    "timestamp": "2026-01-26 05:06:09.109701",
    "report_generated": false
  }
]
[
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: get_min_viable_version()] [Lock contention] High-frequency calls to this function (from queries) may contend for latest_version.lock() - can this create a performance bottleneck during high query load? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_fbd77735-c136-43e8-8793-872946f71784?mode=deep",
    "timestamp": "2026-01-21 00:58:27.681915",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: save_min_readable_version()] [Write amplification] Is write_pruner_progress() called too frequently, causing excessive database writes that degrade write performance for transaction commits? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_eec40e51-c53a-4d4a-816f-41f2aa44d994?mode=deep",
    "timestamp": "2026-01-21 00:58:40.091460",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: init_pruner()] [Thread creation] Does PrunerWorker spawn a new OS thread - can malicious configurations cause thread exhaustion by creating many pruner managers? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_86cbf9b1-dd9d-464a-8115-4a52d8270543?mode=deep",
    "timestamp": "2026-01-21 00:58:52.903069",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: new()] [Memory allocation] The Arc<Mutex<Version>> allocation - can memory exhaustion during initialization cause allocation failures that leave the pruner in an invalid state? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_39faa798-c63f-4917-9d38-c2569d1c94f2?mode=deep",
    "timestamp": "2026-01-21 00:59:06.053070",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: get_min_viable_version()] [Validator inconsistency] If validators have different prune_window or user_pruning_window_offset configurations, can they prune different data ranges, causing state proof verification to fail across nodes? (Critical)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_47d274d9-f60f-4554-8a3c-8dffe40a2d2b?mode=deep",
    "timestamp": "2026-01-21 00:59:19.894331",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: maybe_set_pruner_target_db_version()] [Pruning delay] If pruning lags significantly behind latest_version due to the batch_size condition, can validators accumulate excessive storage, causing operational issues? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_42f90f75-df9c-48ab-9ee6-25370e999aef?mode=deep",
    "timestamp": "2026-01-21 00:59:34.637717",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: get_min_readable_version()] [Query routing] If different API nodes have different min_readable_version values due to pruning delays, can clients receive inconsistent query results depending on which node they hit? (High)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_e83101c4-cb7c-4401-9bcf-e2d59776b297?mode=deep",
    "timestamp": "2026-01-21 00:59:50.971297",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Struct: LedgerPrunerManager] [Crash recovery] After a validator crash and restart, if the pruner resumes from an incorrect version, can it re-prune already pruned data, causing double-deletion attempts and errors? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_ac1eb9e3-3e25-4ede-9a38-f050e3bcae06?mode=deep",
    "timestamp": "2026-01-21 01:00:07.959351",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: save_min_readable_version()] [Replication lag] If pruning completes on one node but save_min_readable_version() fails to replicate to other nodes (in distributed deployment), can query inconsistencies occur? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_da4089dc-c43a-4ce5-b856-beb52896090e?mode=deep",
    "timestamp": "2026-01-21 01:00:26.099009",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: maybe_set_pruner_target_db_version()] [Cast overflow] The pruning_batch_size (usize) is cast to u64 at line 74 - can this overflow on 32-bit systems or cause unexpected behavior? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_b1732a6e-74b9-4516-9fd4-fff73e158949?mode=deep",
    "timestamp": "2026-01-21 01:00:45.046027",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: init_pruner()] [Metric cast] The i64 casts at lines 153 and 157 for metrics - if prune_window or batch_size exceed i64::MAX, can this cause negative or incorrect metric values? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_f8baf1c3-6855-4aa6-8661-930a10c08ac4?mode=deep",
    "timestamp": "2026-01-21 01:01:04.533159",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: get_min_viable_version()] [Saturating arithmetic safety] Multiple saturating_sub calls (lines 56-57, 58) - can chained saturation hide arithmetic errors that should be caught and reported? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_70d1df20-1e62-4a37-9f85-5c5a68b4fa04?mode=deep",
    "timestamp": "2026-01-21 01:01:24.919275",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: set_pruner_target_db_version()] [Version arithmetic] Is there validation that latest_version >= prune_window before saturating_sub at line 164, or can this silently return 0 when it shouldn't? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_6250e50b-6788-438f-896e-2526feeb68a2?mode=deep",
    "timestamp": "2026-01-21 01:01:46.141973",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: get_min_viable_version()] [Max comparison] The std::cmp::max at line 59 - can this hide issues where both values are incorrect, returning the 'larger incorrect value'? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_163190d1-3a16-472f-9d85-4d7090ea3f12?mode=deep",
    "timestamp": "2026-01-21 01:02:08.665213",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: is_pruner_enabled()] [State transition] If pruner configuration changes from enabled to disabled at runtime, does the code handle this gracefully, or can it cause calls to disabled pruner functions? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_845dd140-6a21-4ad8-ab7d-2094f8a21b65?mode=deep",
    "timestamp": "2026-01-21 01:02:29.865266",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: new()] [Initialization order] If ledger_db is not fully initialized when passed to new(), can this cause get_ledger_pruner_progress() to read invalid data? (Medium)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_66167166-9a97-415b-b3fc-928a9767d7cf?mode=deep",
    "timestamp": "2026-01-21 01:02:53.536924",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Struct: LedgerPrunerManager] [Drop behavior] Does LedgerPrunerManager implement Drop to ensure pruner_worker thread is properly shut down, or can thread leaks occur? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_0e5a7e69-9c34-4a12-9991-ad6f0fd82363?mode=deep",
    "timestamp": "2026-01-21 01:03:15.871889",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: set_pruner_target_db_version()] [Repeated calls] Can calling this function repeatedly with the same latest_version cause redundant work or state corruption in the pruner_worker? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_254501cf-5225-4468-8846-627d6c53b881?mode=deep",
    "timestamp": "2026-01-21 01:03:39.606614",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: is_pruning_pending()] [State consistency] Can is_pruning_pending() return true even when pruner is disabled, causing incorrect status reporting? (Low)",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_dbdd1cbd-4e45-4135-961d-671e782533ec?mode=deep",
    "timestamp": "2026-01-21 01:04:03.469247",
    "report_generated": false
  },
  {
    "question": "[File: aptos-core/storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs] [Function: get_prune\n\n### Citations\n\n**File:** storage/aptosdb/src/pruner/ledger_pruner/ledger_pruner_manager.rs (L1-177)\n```rust\n// Copyright Â© Aptos Foundation\n// SPDX-License-Identifier: Apache-2.0\n\nuse crate::{\n    ledger_db::LedgerDb,\n    metrics::{PRUNER_BATCH_SIZE, PRUNER_VERSIONS, PRUNER_WINDOW},\n    pruner::{\n        ledger_pruner::LedgerPruner, pruner_manager::PrunerManager, pruner_utils,\n        pruner_worker::PrunerWorker,\n    },\n};\nuse aptos_config::config::LedgerPrunerConfig;\nuse aptos_db_indexer::db_indexer::InternalIndexerDB;\nuse aptos_infallible::Mutex;\nuse aptos_storage_interface::Result;\nuse aptos_types::transaction::{AtomicVersion, Version};\nuse std::sync::{atomic::Ordering, Arc};\n\n/// The `PrunerManager` for `LedgerPruner`.\npub(crate) struct LedgerPrunerManager {\n    ledger_db: Arc<LedgerDb>,\n    /// DB version window, which dictates how many version of other stores like transaction, ledger\n    /// info, events etc to keep.\n    prune_window: Version,\n    /// It is None iff the pruner is not enabled.\n    pruner_worker: Option<PrunerWorker>,\n    /// Ideal batch size of the versions to be sent to the ledger pruner\n    pruning_batch_size: usize,\n    /// latest version\n    latest_version: Arc<Mutex<Version>>,\n    /// Offset for displaying to users\n    user_pruning_window_offset: u64,\n    /// The minimal readable version for the ledger data.\n    min_readable_version: AtomicVersion,\n}\n\nimpl PrunerManager for LedgerPrunerManager {\n    type Pruner = LedgerPruner;\n\n    fn is_pruner_enabled(&self) -> bool {\n        self.pruner_worker.is_some()\n    }\n\n    fn get_prune_window(&self) -> Version {\n        self.prune_window\n    }\n\n    fn get_min_readable_version(&self) -> Version {\n        self.min_readable_version.load(Ordering::SeqCst)\n    }\n\n    fn get_min_viable_version(&self) -> Version {\n        let min_version = self.get_min_readable_version();\n        if self.is_pruner_enabled() {\n            let adjusted_window = self\n                .prune_window\n                .saturating_sub(self.user_pruning_window_offset);\n            let adjusted_cutoff = self.latest_version.lock().saturating_sub(adjusted_window);\n            std::cmp::max(min_version, adjusted_cutoff)\n        } else {\n            min_version\n        }\n    }\n\n    /// Sets pruner target version when necessary.\n    fn maybe_set_pruner_target_db_version(&self, latest_version: Version) {\n        *self.latest_version.lock() = latest_version;\n\n        let min_readable_version = self.get_min_readable_version();\n        // Only wake up the ledger pruner if there are `ledger_pruner_pruning_batch_size` pending\n        // versions.\n        if self.is_pruner_enabled()\n            && latest_version\n                >= min_readable_version + self.pruning_batch_size as u64 + self.prune_window\n        {\n            self.set_pruner_target_db_version(latest_version);\n        }\n    }\n\n    fn save_min_readable_version(&self, min_readable_version: Version) -> Result<()> {\n        self.min_readable_version\n            .store(min_readable_version, Ordering::SeqCst);\n\n        PRUNER_VERSIONS\n            .with_label_values(&[",
    "url": "https://deepwiki.com/search/-you-are-an-elite-aptos-blockc_59727942-a26d-4a34-a0be-8c9a81845516?mode=deep",
    "timestamp": "2026-01-21 01:04:28.455301",
    "report_generated": false
  }
]
[
  "[File: aptos-move/framework/src/natives/code.rs] [Metadata: Manifest] [TOML/YAML format] Manifest is likely TOML or YAML - can parser vulnerabilities in manifest processing cause RCE or DoS? (High)",
  "[File: aptos-move/framework/src/natives/code.rs] [Metadata: Digest mismatch] [source_digest field] Source digest is stored but validation not visible in this file - can attackers publish code where bytecode doesn't match source digest, hiding malicious modifications? (Critical)",
  "[File: aptos-move/framework/src/natives/code.rs] [Upgrade: Policy enforcement] [check_compat flag] Compatibility checking enabled for non-arbitrary policies - is the actual compatibility check robust, or can attackers craft bytecode that passes checks but breaks compatibility? (Critical)",
  "[File: aptos-move/framework/src/natives/code.rs] [Upgrade: Version tracking] [upgrade_number field] Increments on each upgrade - can race conditions during concurrent upgrades cause version number collisions or skips? (Medium)",
  "[File: aptos-move/framework/src/natives/code.rs] [Upgrade: Immutable bypass] [Policy: 2] Immutable packages should never upgrade - can governance, admin keys, or VM bugs bypass immutability guarantees? (Critical)",
  "[File: aptos-move/framework/src/natives/code.rs] [Upgrade: Rollback] [No rollback mechanism] No visible way to rollback upgrades - if malicious code is deployed, can it be removed, or is the package permanently compromised? (High)",
  "[File: aptos-move/framework/src/natives/code.rs] [Upgrade: Policy change] [UpgradePolicy modification] Can upgrade policy be changed from immutable to arbitrary after deployment, undermining immutability guarantees? (Critical)",
  "[File: aptos-move/framework/src/natives/code.rs] [Error: PartialVMError] [Error propagation] Multiple functions return PartialVMError - are all errors properly caught and handled, or can some errors cause transaction success with partial state changes? (High)",
  "[File: aptos-move/framework/src/natives/code.rs] [Error: SafeNativeError] [Abort codes] Native functions abort with specific codes - can abort codes be spoofed or manipulated to hide attack vectors or cause incorrect error handling? (Medium)",
  "[File: aptos-move/framework/src/natives/code.rs] [Error: INTERNAL_TYPE_ERROR] [Status code] Used for type conversion failures - can this error be triggered intentionally to cause DoS or bypass validation? (Medium)",
  "[File: aptos-move/framework/src/natives/code.rs] [Error: Unwrap usage] [Panic conditions] Several unwrap() calls that can panic - can any of these be triggered by attacker-controlled input to crash validators? (High)",
  "[File: aptos-move/framework/src/natives/code.rs] [Integration: VM extraction] [extract_publish_request] VM calls this to get publish request - can timing of extraction be manipulated to extract requests from wrong transactions? (Critical)",
  "[File: aptos-move/framework/src/natives/code.rs] [Integration: VM extensions] [TidAble trait] NativeCodeContext implements TidAble for extension system - can type ID collisions cause wrong context to be retrieved, mixing state between transactions? (High)",
  "[File: aptos-move/framework/src/natives/code.rs] [Integration: Gas schedule] [aptos_framework gas params] Uses gas parameters from external config - can gas schedule updates retroactively affect ongoing transactions or cause inconsistencies? (Medium)",
  "[File: aptos-move/framework/src/natives/code.rs] [Integration: Module publishing flow] [Multi-step process] Native creates request, VM extracts and processes - can this multi-step flow be interrupted, leaving partial state or allowing request manipulation? (High)",
  "[File: aptos-move/framework/src/natives/code.rs] [System: Framework upgrades] [Core module deployment] This code enables framework upgrades - can malicious upgrades to core modules (0x1 address) compromise the entire network? (Critical)",
  "[File: aptos-move/framework/src/natives/code.rs] [System: Governance bypass] [Arbitrary policy] Can attackers with arbitrary upgrade policy bypass governance requirements and deploy changes without community approval? (Critical)",
  "[File: aptos-move/framework/src/natives/code.rs] [System: Validator code] [Consensus module deployment] Can malicious validators deploy code that affects consensus, staking, or other critical system functions? (Critical)",
  "[File: aptos-move/framework/src/natives/code.rs] [System: Genesis deployment] [Initial code publishing] How is code published during genesis, and can the genesis process be exploited to deploy malicious initial state? (High)",
  "[File: aptos-move/framework/src/natives/code.rs] [System: Emergency response] [No emergency stops] No visible emergency mechanism to halt code publishing during attacks - can malicious code deployment be stopped if detected? (High)",
  "[File: aptos-move/framework\n\n### Citations\n\n**File:** aptos-move/framework/src/natives/code.rs (L1-357)\n```rust\n// Copyright Â© Aptos Foundation\n// SPDX-License-Identifier: Apache-2.0\n\nuse crate::unzip_metadata_str;\nuse anyhow::bail;\nuse aptos_gas_schedule::gas_params::natives::aptos_framework::*;\nuse aptos_native_interface::{\n    safely_pop_arg, RawSafeNative, SafeNativeBuilder, SafeNativeContext, SafeNativeError,\n    SafeNativeResult,\n};\nuse aptos_types::{\n    move_any::Any, on_chain_config::OnChainConfig, transaction::ModuleBundle, vm_status::StatusCode,\n};\nuse better_any::{Tid, TidAble};\nuse move_binary_format::errors::{PartialVMError, PartialVMResult};\nuse move_core_types::{account_address::AccountAddress, gas_algebra::NumBytes};\nuse move_vm_runtime::{native_extensions::SessionListener, native_functions::NativeFunction};\nuse move_vm_types::{\n    loaded_data::runtime_types::Type,\n    values::{Struct, Value},\n};\nuse serde::{Deserialize, Serialize};\nuse smallvec::{smallvec, SmallVec};\nuse std::{\n    collections::{btree_map::Entry, BTreeMap, BTreeSet, VecDeque},\n    fmt,\n    str::FromStr,\n};\n\n/// The package registry at the given address.\n#[derive(Clone, Debug, Serialize, Deserialize, Eq, PartialEq)]\npub struct PackageRegistry {\n    /// Packages installed at this address.\n    pub packages: Vec<PackageMetadata>,\n}\n\nimpl OnChainConfig for PackageRegistry {\n    const MODULE_IDENTIFIER: &'static str ="
]
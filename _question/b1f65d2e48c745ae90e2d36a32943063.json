[
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Timing] [Update Frequency Race] The batch metadata update logic (lines 214-225) checks if enough time has passed since last update - can race conditions between checking and updating cause multiple threads to think they should update simultaneously? (Medium)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Timing] [Sleep Until Overflow] The sleep_until call at lines 221-224 adds durations - can the sum overflow Duration's maximum value and cause a panic or incorrect sleep behavior? (Low)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Timing] [Metadata Staleness Window] Between checking update frequency (line 250) and actually updating (line 254), the metadata can become stale - can crashes during this window cause significant transaction data loss? (Medium)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Integer Arithmetic] [Version Addition Overflow] At line 254, last_version + 1 is calculated for the new metadata version - although Rust checks for overflow in debug mode, is overflow checking enabled in release mode, and what happens if version reaches u64::MAX? (Low)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Integer Arithmetic] [Modulo Zero] The expression version % NUM_TXNS_PER_FOLDER (line 101) assumes NUM_TXNS_PER_FOLDER is never zero - but if this constant is accidentally set to 0, can it cause division by zero panics? (Low)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Integer Arithmetic] [Size Bytes Cast] At line 140, size_bytes is converted from usize to u64 with 'as u64' - can this truncate on 128-bit systems or cause incorrect metrics on systems where usize is larger than u64? (Low)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Integer Arithmetic] [Folder Calculation Overflow] The NUM_TXNS_PER_FOLDER (100,000) is used for folder organization - can version numbers approaching u64::MAX cause overflow when calculating folder numbers (version / NUM_TXNS_PER_FOLDER)? (Low)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Integer Arithmetic] [Size Accumulation] The MAX_SIZE_PER_FILE (50MB = 50 * (1 << 20)) calculation at line 27 - can the left shift operation overflow if constants are modified, or can the usize type cause issues on 32-bit systems? (Low)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Type Safety] [Metadata Deserialization Attack] When deserializing FileStoreMetadata and BatchMetadata from storage (lines 69-72, 98), are there any validation checks on the deserialized data structure to prevent malformed data from causing undefined behavior? (High)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Type Safety] [Transaction Type Assumptions] The code assumes Transaction type from aptos_protos (line 18) - can protobuf version mismatches or schema changes cause deserialization failures or data corruption when reading old transaction data? (Medium)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Type Safety] [Arc Weak Reference] The code uses Arc<dyn IFileStore> (line 35) but never checks for weak reference validity - can the underlying storage be dropped while the uploader is still running, causing use-after-free? (High)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Type Safety] [PathBuf Validation] PathBuf instances are created and passed to storage operations (lines 60, 272) - can invalid Unicode or OS-specific path issues cause file operation failures that aren't properly handled? (Low)",
  "[File: aptos-core/ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs] [Type Safety] [Option Unwr\n\n### Citations\n\n**File:** ecosystem/indexer-grpc/indexer-grpc-manager/src/file_store_uploader.rs (L1-275)\n```rust\n// Copyright Â© Aptos Foundation\n// SPDX-License-Identifier: Apache-2.0\n\nuse crate::{\n    data_manager::DataManager,\n    metrics::{FILE_STORE_UPLOADED_BYTES, FILE_STORE_VERSION, TIMER},\n};\nuse anyhow::Result;\nuse aptos_indexer_grpc_utils::{\n    compression_util::{FileEntry, StorageFormat},\n    config::IndexerGrpcFileStoreConfig,\n    file_store_operator_v2::{\n        common::{BatchMetadata, FileStoreMetadata, IFileStore, METADATA_FILE_NAME},\n        file_store_operator::FileStoreOperatorV2,\n        file_store_reader::FileStoreReader,\n    },\n};\nuse aptos_protos::transaction::v1::Transaction;\nuse std::{path::PathBuf, sync::Arc, time::Duration};\nuse tokio::{\n    sync::{mpsc::channel, oneshot::Sender},\n    time::Instant,\n};\nuse tracing::info;\n\nconst NUM_TXNS_PER_FOLDER: u64 = 100000;\nconst MAX_SIZE_PER_FILE: usize = 50 * (1 << 20);\nconst MAX_NUM_FOLDERS_TO_CHECK_FOR_RECOVERY: usize = 5;\nconst MIN_UPDATE_FREQUENCY: Duration = Duration::from_secs(10);\n\npub(crate) struct FileStoreUploader {\n    chain_id: u64,\n    reader: FileStoreReader,\n    // TODO(grao): Change to IFileStoreReader when the trait_upcasting feature is in stable Rust.\n    writer: Arc<dyn IFileStore>,\n\n    last_batch_metadata_update_time: Option<Instant>,\n    last_metadata_update_time: Instant,\n}\n\nimpl FileStoreUploader {\n    pub(crate) async fn new(\n        chain_id: u64,\n        file_store_config: IndexerGrpcFileStoreConfig,\n    ) -> Result<Self> {\n        let file_store = file_store_config.create_filestore().await;\n        if !file_store.is_initialized().await {\n            info!(\n                chain_id = chain_id,"
]
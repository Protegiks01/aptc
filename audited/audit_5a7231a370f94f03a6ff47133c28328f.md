# Audit Report

## Title
Information Disclosure via Verbose Error Logging in Mempool Notification Failures

## Summary
The `CommitNotificationError` in the mempool notifications module includes the full `SendError` details when logging channel communication failures, potentially exposing committed transaction details and internal channel state to observers with access to validator logs. However, this is correctly classified as **Low severity** since the leaked transaction data is already public on the blockchain and exploitation requires privileged log access.

## Finding Description
When state-sync fails to notify mempool of committed transactions via the mpsc channel, the error handling code creates a verbose error message: [1](#0-0) 

This error message includes the full `SendError` which contains the entire `MempoolCommitNotification` that failed to send: [2](#0-1) 

Each `CommittedTransaction` includes: [3](#0-2) 

This error is then logged using the `error!` macro in the notification handler: [4](#0-3) 

The leaked information includes:
- Account addresses (sender)
- Sequence numbers or nonces (replay_protector)
- Transaction use case information
- Block timestamps
- Internal channel state (disconnected/full)

**Critical Limitation**: However, all transaction data (addresses, sequence numbers, timestamps) is **already public** on the blockchain since these errors only occur for committed transactions.

## Impact Explanation
This falls under **Low Severity** per the Aptos bug bounty program ("Minor information leaks" - up to $1,000).

**Why NOT Higher Severity:**
- **No cryptographic material exposed**: No private keys, validator keys, or authentication credentials are leaked
- **Transaction data is public**: All leaked transaction details are already visible on the blockchain
- **Requires privileged access**: Observer must have access to validator logs (not "unprivileged attacker")
- **No path to funds loss or consensus break**: Does not enable theft, minting, or protocol violations
- **Operational intelligence only**: At most reveals component health and timing information

The only genuinely internal information is that the state-sync to mempool channel communication failed, which reveals validator operational state but has no direct security exploitation path.

## Likelihood Explanation
**Medium-High Likelihood** of information exposure IF:
- An observer has access to validator logs (operator, compromised system, or centralized logging)
- Channel failures occur (mempool not listening, channel capacity reached)

**CRITICAL CONSTRAINT**: This is NOT exploitable by unprivileged attackers. It requires:
1. Access to validator node logs (privileged)
2. Channel failure to occur (operational issue)

## Recommendation
Reduce verbosity of error messages to avoid including full transaction details:

```rust
if let Err(error) = self
    .notification_sender
    .clone()
    .send(commit_notification)
    .await
{
    return Err(Error::CommitNotificationError(format!(
        "Failed to notify mempool of committed transactions. \
         Transaction count: {}, Error type: {}",
        commit_notification.transactions.len(),
        if error.is_disconnected() { "Disconnected" } else { "Full" }
    )));
}
```

This preserves debugging information (transaction count, failure reason) without exposing specific transaction details.

## Proof of Concept
Not applicable - this is an information disclosure issue requiring log access, not an exploitable vulnerability. The transaction data leaked is already public on the blockchain, and accessing logs requires privileged validator operator access.

---

## Notes

**VALIDATION RESULT**: While this IS a legitimate information disclosure issue as described in the security question, it **FAILS** the strict validation checklist for the following reasons:

1. ✗ **Not exploitable by unprivileged attacker** - Requires validator log access
2. ✗ **Does not meet Critical/High/Medium severity** - This is Low severity  
3. ✗ **Does not break documented invariants** - Information leak, not invariant violation
4. ✗ **No clear security harm** - Leaked data is public; only reveals operational state

Per the instructions: "False positives harm credibility more than missed findings" and the bar is "EXTREMELY high" for Critical/High/Medium vulnerabilities.

This issue is correctly classified as **Low severity** in the original security question and represents a minor operational security concern rather than an exploitable vulnerability that would justify a bug bounty claim above the Low category.

### Citations

**File:** state-sync/inter-component/mempool-notifications/src/lib.rs (L109-112)
```rust
            return Err(Error::CommitNotificationError(format!(
                "Failed to notify mempool of committed transactions! Error: {:?}",
                error
            )));
```

**File:** state-sync/inter-component/mempool-notifications/src/lib.rs (L147-152)
```rust
/// A notification for newly committed transactions sent by state sync to mempool.
#[derive(Debug)]
pub struct MempoolCommitNotification {
    pub transactions: Vec<CommittedTransaction>,
    pub block_timestamp_usecs: u64, // The timestamp of the committed block.
}
```

**File:** state-sync/inter-component/mempool-notifications/src/lib.rs (L165-170)
```rust
#[derive(Clone, Debug, Eq, PartialEq)]
pub struct CommittedTransaction {
    pub sender: AccountAddress,
    pub replay_protector: ReplayProtector,
    pub use_case: UseCaseKey,
}
```

**File:** state-sync/state-sync-driver/src/notification_handlers.rs (L533-538)
```rust
        if let Err(error) = result {
            let error = Error::NotifyMempoolError(format!("{:?}", error));
            error!(LogSchema::new(LogEntry::NotificationHandler)
                .error(&error)
                .message("Failed to notify mempool of committed transactions!"));
            Err(error)
```

# Audit Report

## Title
Sensitive Credentials Exposure via Debug Trait Implementation in NFT Metadata Crawler Configuration

## Summary
The `AssetUploaderWorkerConfig` struct derives the `Debug` trait, causing sensitive Cloudflare API keys to be exposed in plaintext when the configuration is logged during service startup. [1](#0-0) 

## Finding Description
The NFT metadata crawler logs its complete configuration on startup using Debug formatting. The configuration struct hierarchy is:
- `NFTMetadataCrawlerConfig` (derives Debug) contains `server_config: ServerConfig`
- `ServerConfig` (derives Debug) has variant `AssetUploaderWorker(AssetUploaderWorkerConfig)`  
- `AssetUploaderWorkerConfig` (derives Debug) contains `cloudflare_auth_key: String`

When the service starts, the entire config is logged: [2](#0-1) 

This causes the `cloudflare_auth_key` field to be printed in plaintext to application logs. Additionally, the `ParserConfig` struct also derives Debug and contains `ipfs_auth_key: Option<String>`, which suffers from the same vulnerability. [3](#0-2) 

The credentials are exposed through:
- Container logs (Docker/Kubernetes)
- Log aggregation systems (ELK, Splunk, CloudWatch)
- Log files on disk
- Error monitoring platforms
- CI/CD pipeline outputs
- Developer terminals during debugging

## Impact Explanation
While this is a genuine information disclosure vulnerability, it falls under **Low Severity** ($1,000) per the Aptos bug bounty program as a "minor information leak." 

The NFT metadata crawler is an ecosystem tool, not a core blockchain component. Compromised Cloudflare/IPFS credentials enable:
- Unauthorized image uploads/deletions to Cloudflare
- Access to IPFS private content
- Potential abuse of third-party service quotas

However, this does NOT affect:
- Consensus safety or liveness
- Validator operations
- Move VM execution
- On-chain state or funds
- Blockchain availability

## Likelihood Explanation
**High likelihood** - This vulnerability triggers automatically on every service startup. Logs are commonly accessible to developers, operators, and monitoring systems, making credential extraction trivial for anyone with log read access.

## Recommendation
Implement custom Debug implementations that redact sensitive fields:

```rust
use std::fmt;

impl fmt::Debug for AssetUploaderWorkerConfig {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        f.debug_struct("AssetUploaderWorkerConfig")
            .field("cloudflare_auth_key", &"<redacted>")
            .field("cloudflare_account_id", &self.cloudflare_account_id)
            .finish()
    }
}
```

Apply similar implementations to `ParserConfig` for `ipfs_auth_key` and `NFTMetadataCrawlerConfig` for `database_url`.

## Proof of Concept

**Steps to reproduce:**
1. Create a configuration file with real Cloudflare credentials
2. Start the NFT metadata crawler service
3. Check application logs - the `cloudflare_auth_key` appears in plaintext

**Expected log output:**
```
INFO [NFT Metadata Crawler] Starting with config: NFTMetadataCrawlerConfig { 
  database_url: "postgres://user:pass@host/db", 
  server_port: 8080, 
  server_config: AssetUploaderWorker(
    AssetUploaderWorkerConfig { 
      cloudflare_auth_key: "abc123-actual-secret-key-xyz789", 
      cloudflare_account_id: "account123" 
    }
  ) 
}
```

## Notes
This vulnerability does **not** meet the High/Critical/Medium severity threshold required for significant bounty payouts because it affects a peripheral ecosystem service rather than core blockchain infrastructure. It should be classified as **Low Severity** per the bug bounty guidelines ("Minor information leaks"). While remediation is recommended for security hygiene, this does not constitute a critical blockchain security risk.

### Citations

**File:** ecosystem/nft-metadata-crawler/src/asset_uploader/worker/config.rs (L7-14)
```rust
#[derive(Clone, Debug, Deserialize, Serialize)]
#[serde(deny_unknown_fields)]
pub struct AssetUploaderWorkerConfig {
    /// Cloudflare API key
    pub cloudflare_auth_key: String,
    /// Cloudflare Account ID provided at the images home page used to authenticate requests
    pub cloudflare_account_id: String,
}
```

**File:** ecosystem/nft-metadata-crawler/src/config.rs (L30-37)
```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
#[serde(tag = "type")]
pub enum ServerConfig {
    Parser(ParserConfig),
    AssetUploaderWorker(AssetUploaderWorkerConfig),
    AssetUploaderApi,
    AssetUploaderThrottler(AssetUploaderThrottlerConfig),
}
```

**File:** ecosystem/nft-metadata-crawler/src/config.rs (L88-88)
```rust
        info!("[NFT Metadata Crawler] Starting with config: {:?}", self);
```

[
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Unsupported metric types] Lines 57-60 silently ignore unsupported metric types with a comment 'Do nothing'. Can an attacker exploit newly added Prometheus metric types (SUMMARY, UNTYPED) to bypass metric collection and hide malicious validator behavior? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Label cardinality explosion] Can an attacker generate metrics with extremely high label cardinality (thousands of unique label combinations) that cause the HashMap at line 25 to grow to gigabytes in size, exhausting validator memory? (High)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: flatten_metric_with_labels()] [String concatenation DoS] The string operations at lines 105-111 create temporary Vec and String allocations. Can an attacker trigger excessive allocations by providing metrics with hundreds of labels, causing memory pressure and GC pauses? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Writer buffer overflow] If the writer buffer passed at line 24 has a fixed size and serde_json attempts to write more data than available at line 67, can this cause a write error that's not properly handled, leaving metrics partially written? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: flatten_metric_with_labels()] [Metric name length limits] Is there a maximum length validation for the flattened metric name at line 119? Can an attacker create metrics with hundreds of labels that produce extremely long names, causing buffer overflows in downstream systems? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Malformed MetricFamily] Does the function validate that metric_family.get_name() at line 29 returns a valid, non-empty string, or can null/empty metric names cause panics or invalid JSON keys? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Metric type mismatch] Can an attacker provide a MetricFamily where get_field_type() returns COUNTER but the actual metric data is a GAUGE, causing the wrong getter to be called at line 36 and potentially panicking? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: flatten_metric_with_labels()] [LabelPair validation] Does get_value() at line 108 properly validate label values, or can malformed protobuf data cause panics when accessing label pairs? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Negative metric values] Can counter or gauge values be negative (lines 36, 42), and if so, does this violate Prometheus semantics and cause monitoring systems to reject the metrics? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Writer error propagation] At line 67, write_all() can return an io::Error. Is this error properly propagated through the '?' operator, or can write failures be silently ignored in some code paths? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Partial write handling] If writer.write_all() at line 67 fails midway through writing the JSON string, is the writer left in a consistent state, or can partial data corrupt subsequent metric responses? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Error logging side-effects] The error log at line 70 uses format! which allocates. Can repeated serialization failures cause secondary memory exhaustion from log buffer allocation during error handling? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Metrics endpoint authentication] Does the inspection service properly authenticate requests to the JSON metrics endpoint, or can unauthorized actors query validator metrics to gather intelligence for targeted attacks? (High)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: format_type()] [Content-Type mismatch] The format_type() method at line 77 returns CONTENT_TYPE_JSON, but if the actual encoding fails and empty data is written, can clients misinterpret the response as valid JSON? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Consensus metric manipulation] Can an attacker manipulate consensus-related metrics (round numbers, view changes, validator votes) before they're encoded, causing monitoring systems to false-alarm or miss actual consensus failures? (High)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: flatten_metric_with_labels()] [Metric name collision with system metrics] Can flattening create names that collide with critical Aptos system metrics (aptos_consensus_*, aptos_state_sync_*), causing legitimate metrics to be overwritten and hiding validator issues? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Timestamp handling] Line 19 mentions timestamps are ignored. Can this cause monitoring systems to misinterpret when metrics were collected, leading to incorrect alerting or stale data being treated as current? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [HISTOGRAM bucket loss] HISTOGRAM metrics at line 45 only export count/sum but not bucket boundaries. Can this prevent accurate latency percentile calculation needed to detect consensus performance degradation? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Metric metadata loss] The encoding process strips metric help text, type information, and units. Can this loss of metadata cause operators to misinterpret critical validator health metrics? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: flatten_metric_with_labels()] [Label ordering non-determinism] The iterator at line 105-108 may not have deterministic ordering. Can different label orderings for the same metric create duplicate entries in the HashMap, wasting memory and confusing monitoring systems? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: flatten_metric_with_labels()] [Reserved character conflicts] If label values contain periods ('.'), the join at line 111 creates ambiguous metric names. Can 'metric.label1.value.with.dots' be confused with a metric that has multiple labels? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Format string injection] When constructing histogram metric names at lines 49 and 53 using format!, can user-controlled name values cause format string injection if name contains '{}' or other format specifiers? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: flatten_metric_with_labels()] [String allocation efficiency] The function creates multiple temporary String and Vec allocations (lines 99, 105, 111). For high-cardinality metrics called frequently, can this cause heap fragmentation and performance degradation? (Low)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [HashMap resize thrashing] As the HashMap at line 25 grows, it performs rehashing. Can an attacker trigger worst-case resize behavior with adversarial metric counts that cause repeated rehashing and CPU spikes? (Medium)",
  "[File: aptos-core/crates/aptos-inspection-service/src/server/json_encoder.rs] [Function: encode()] [Drop order safety] When the function returns, are the HashMap and temporary strings properly dropped, or can panic during encoding (lines 36-55) cause memory leaks via incomplete cleanup? (Low)"
]
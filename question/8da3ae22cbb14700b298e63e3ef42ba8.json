[
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Edge Case: max_chunk_size = 1] [Pathological Chunking] If max_chunk_size is set to 1 byte, every transaction becomes its own chunk. Can this cause excessive storage overhead, performance degradation, or hit filesystem limits on number of files? (Medium)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Edge Case: Backup retry after failure] [Idempotency] If run_impl() fails partway and is retried with identical parameters, can the backup resume or will it create duplicate/conflicting files in storage due to non-idempotent operations? (High)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Error Handling: Partial writes] [Rollback] If write_chunk() at line 90 succeeds for some chunks but later write_chunk() or write_manifest() fails, there's no rollback mechanism. Are partial backups safely detectable and cleanable? (High)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Error Handling: Client failures] [Transient vs Permanent] If get_transactions() at line 82 fails with network error, does the code distinguish transient (retry-able) from permanent errors? Or does any error abort the entire backup? (Medium)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Error Handling: Storage failures] [Disk Full] If storage runs out of space during chunk writes, are errors propagated correctly, and can operator identify which chunks are incomplete? Or does partial data remain without clear indication? (High)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Error Handling: Assert vs Result] [Panic vs Error] Line 108's assert!() panics rather than returning Result. Should this be a proper error return for better error handling and operator diagnostics? (Low)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Error Handling: ensure! macro] [Error Messages] The ensure! at lines 110-115 provides error message, but does it include enough context (backup_name, current chunk, etc.) for operators to diagnose failures? (Low)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Performance: Memory usage] [Unbounded Growth] If should_cut_chunk() has a bug or max_chunk_size is huge, chunk_bytes Vec at line 79 can grow without bound before being flushed, causing OOM. Is there a hard limit? (High)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Performance: Large num_transactions] [Time to Complete] If num_transactions is billions, the backup could take days. Is there progress tracking, checkpointing, or ability to pause/resume? Or must it complete in single run? (Low)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Performance: Network bandwidth] [Stream Backpressure] If BackupServiceClient streams transactions faster than BackupStorage can write (lines 88-106), is there backpressure or buffering? Can this cause memory exhaustion? (Medium)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [DoS: Malicious chunk sizes] [Resource Exhaustion] If BackupServiceClient returns transactions with manipulated record_bytes lengths, can this cause should_cut_chunk() to behave pathologically, creating excessive chunks or exhausting storage? (Medium)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Consistency: Version continuity] [Snapshot Consistency] If the blockchain is actively processing transactions during backup (start_version to start_version + num_transactions), does the backup capture a consistent snapshot, or can it have inconsistent state if ledger state changes mid-backup? (Critical)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Consistency: Manifest ordering] [Chunk Order] The chunks Vec at line 78 is built by pushing chunks in the order they're created (lines 98, 124). If async operations complete out of order, could chunks be pushed in wrong sequence? (Medium)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Restore Compatibility: Format version] [Version Skew] TransactionChunkFormat::V1 is hardcoded at line 186. If restore code expects different format or if future versions change format, can old backups still be restored? Is there version negotiation? (Medium)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Restore Compatibility: Metadata] [Metadata Dependencies] The Metadata at line 211 is saved separately. If metadata file is lost but manifest exists, can backups still be discovered and restored? Or is metadata critical for discovery? (Low)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Access Control: BackupServiceClient] [Authentication] The code doesn't show authentication for BackupServiceClient. Can unauthorized actors call this backup operation and exfiltrate full transaction history? (High)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Access Control: BackupStorage] [Storage Permissions] Does BackupStorage enforce proper access controls on created files (manifest, chunks, proofs)? Can unauthorized readers access backed-up transaction data? (Medium)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Access Control: Arbitrary version ranges] [Permission Checks] Can any operator specify any start_version and num_transactions, potentially accessing restricted historical data? Should there be authorization checks based on role? (Medium)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Logging: Progress tracking] [Observability] Only start (line 58) and end (line 66) are logged. For long-running backups, should there be periodic progress logs showing current version, chunks completed, etc.? (Low)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Logging: Error details] [Debugging] If backup fails, does logging provide enough detail (which chunk, what version, why) for operators to debug? Or just generic error from line 65? (Low)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Monitoring: Metrics] [Telemetry] Are metrics emitted for backup duration, bytes written, chunk count, failures? Or must operators rely only on log parsing? (Low)",
  "[File: aptos-core/storage/backup/backup-cli/src/backup_types/transaction/backup.rs] [Config: max_\n\n### Citations\n\n**File:** storage/backup/backup-cli/src/backup_types/transaction/backup.rs (L1-219)\n```rust\n// Copyright © Aptos Foundation\n// Parts of the project are originally copyright © Meta Platforms, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nuse crate::{\n    backup_types::transaction::manifest::{\n        TransactionBackup, TransactionChunk, TransactionChunkFormat,\n    },\n    metadata::Metadata,\n    storage::{BackupHandleRef, BackupStorage, FileHandle, ShellSafeName},\n    utils::{\n        backup_service_client::BackupServiceClient, read_record_bytes::ReadRecordBytes,\n        should_cut_chunk, storage_ext::BackupStorageExt, GlobalBackupOpt,\n    },\n};\nuse anyhow::{anyhow, ensure, Result};\nuse aptos_logger::prelude::*;\nuse aptos_types::transaction::Version;\nuse clap::Parser;\nuse once_cell::sync::Lazy;\nuse std::{convert::TryInto, str::FromStr, sync::Arc};\nuse tokio::io::AsyncWriteExt;\n\n#[derive(Parser)]\npub struct TransactionBackupOpt {\n    #[clap(long ="
]